<div>
  <script ka:lang="js">
    var step = sr.step;
    var result = sr.result;
    var stepId = (scenario.exampleIndex + 1) + '.' + step.line;
    var stepStatus = result.status;
    var stepIndents = Array.from({length: callDepth}, (v, k) => k);
  </script>

  <div th:each="comment: step.comments" class="step-row" th:attrappend="data-parent=${parentId}">
    <div class="step-container">
      <div class="step-ref passed"></div>
      <div th:each="indent: stepIndents" class="step-indent"></div>
      <div class="step-cell comment" th:text="comment"></div>
    </div>
    <div class="time-cell comment"></div>            
  </div>

  <div class="step-row" th:attrappend="data-parent=${parentId}">
    <div class="step-container" th:id="stepId">
      <div class="step-ref" th:classappend="stepStatus" th:text="step.line"></div>
      <div th:each="indent: stepIndents" class="step-indent"></div>
      <div class="step-cell" th:classappend="stepStatus">
        <span th:text="step.prefix"></span>&nbsp;<span th:text="step.text"></span>
      </div>
    </div>
    <div class="time-cell" th:classappend="stepStatus" th:text="Math.round(result.millis)"></div>
  </div>

  <div th:each="embed: step.embeds" class="embed" th:attr="data-parent=${stepId}" th:utext="embed.html"></div>

  <div class="preformatted" th:attr="data-parent=${stepId}" th:if="sr.stepLog" th:text="sr.stepLog"></div>

  <div th:each="cr: sr.callResults">
    <script ka:lang="js">
      var callStatus = cr.failed ? 'failed' : 'passed';
      var callName = cr.packageQualifiedName;
      if (cr.loopIndex !== -1) {
        callName = '[' + cr.loopIndex + ']' + callName;
      }
      var callRefId = sr.refId + '.' + (cr.loopIndex + 1);
    </script>    
    <div class="step-row" th:attrappend="data-parent=${parentId}">
      <div class="step-container" th:id="callRefId">
        <div class="step-ref" th:classappend="callStatus">&gt;&gt;</div>
        <div th:each="indent: stepIndents" class="step-indent"></div>
        <div class="step-cell" th:classappend="callStatus" th:text="callName"></div>
      </div>
      <div class="time-cell" th:classappend="callStatus" th:text="Math.round(cr.durationMillis)"></div>
    </div>
    <div th:each="csr: cr.scenarioResults">
      <div th:each="sr: csr.stepResults" th:include="step-result.html" 
           th:with="callDepth=${cr.callDepth},parentId=${callRefId}"></div>
    </div>    
  </div>

</div>
